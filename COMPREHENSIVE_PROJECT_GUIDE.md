# LeadSync CRM - Complete Project Guide

**Version:** 1.0.0  
**Last Updated:** February 9, 2026  
**Project Type:** Full-Stack SaaS CRM Application  
**Architecture:** Multi-tenant, Frontend + Backend separation

---

## ğŸ“‹ Executive Summary

**LeadSync CRM** is a professional, production-ready SaaS (Software-as-a-Service) lead management platform designed for small and medium-sized businesses (SMBs) across any industry. It provides:

- **Frontend**: Modern React 18 + TypeScript UI with Tailwind CSS (ready for mock data or backend integration)
- **Backend**: Node.js Express API with PostgreSQL & Prisma ORM (currently in development)
- **Multi-tenant**: Supports multiple companies/organizations with role-based access control
- **Integrations**: Telegram webhooks, WhatsApp, Email, and custom lead sources

### Key Differentiators:
âœ… Industry-agnostic (works for Retail, Bakery, E-Commerce, Services, Real Estate, SaaS, etc.)  
âœ… Production-ready code (TypeScript, Tailwind, full UI polish)  
âœ… Backend-agnostic frontend (works with mock data or any backend API)  
âœ… Multi-tenant out-of-the-box  
âœ… Accessible UI components (@headlessui/react)  

---

## ğŸ—ï¸ Project Structure Overview

### Root Directory: `d:\startup\`

```
d:\startup/
â”œâ”€â”€ ğŸ“‚ src/                          # Frontend React application (main codebase)
â”œâ”€â”€ ğŸ“‚ leadsync-backend/             # Backend Node.js API (separate service)
â”œâ”€â”€ ğŸ“‚ dist/                         # Compiled frontend (generated by build)
â”œâ”€â”€ ğŸ“‚ node_modules/                 # Frontend dependencies
â”‚
â”œâ”€â”€ ğŸ“„ package.json                  # Frontend project config
â”œâ”€â”€ ğŸ“„ tsconfig.json                 # TypeScript config (frontend)
â”œâ”€â”€ ğŸ“„ tsconfig.node.json            # TypeScript for build tools
â”œâ”€â”€ ğŸ“„ vite.config.ts                # Vite build configuration
â”œâ”€â”€ ğŸ“„ tailwind.config.js            # Tailwind CSS configuration
â”œâ”€â”€ ğŸ“„ postcss.config.js             # PostCSS for Tailwind
â”œâ”€â”€ ğŸ“„ index.html                    # HTML entry point
â”‚
â”œâ”€â”€ ğŸ“„ README.md                     # Project overview
â”œâ”€â”€ ğŸ“„ RUNNING.md                    # How to run the project
â””â”€â”€ ğŸ“„ COMPREHENSIVE_PROJECT_GUIDE.md # This file
```

---

## ğŸ¨ FRONTEND (`src/`)

### Directory Structure

```
src/
â”œâ”€â”€ ğŸ“‚ components/                   # React components (reusable UI building blocks)
â”‚   â”œâ”€â”€ ğŸ“‚ layout/                   # Layout wrapper components
â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx              # Main navigation sidebar (collapsible)
â”‚   â”‚   â”œâ”€â”€ DashboardLayout.tsx      # Layout container for all dashboard pages
â”‚   â”‚   â””â”€â”€ MarketingNav.tsx         # Top navigation for public pages
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ ui/                       # Low-level UI components
â”‚   â”‚   â”œâ”€â”€ Modal.tsx                # Reusable modal dialog
â”‚   â”‚   â”œâ”€â”€ Spinner.tsx              # Loading spinner animation
â”‚   â”‚   â”œâ”€â”€ Toast.tsx                # Individual toast notification
â”‚   â”‚   â””â”€â”€ ToastContainer.tsx       # Global toast system manager
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ dashboard/                # Dashboard-specific components
â”‚   â”‚   â””â”€â”€ SectionSummary.tsx       # KPI card / metric summary
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ leads/                    # Lead Management UI components
â”‚   â”‚   â”œâ”€â”€ LeadsTable.tsx           # Main leads list (search, filter, sort, pagination)
â”‚   â”‚   â””â”€â”€ LeadDetailModal.tsx      # Lead details popup (tabs: info, notes, chats)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ conversations/            # Messaging / Shared Inbox components
â”‚   â”‚   â””â”€â”€ ChatPanel.tsx            # Chat / message thread UI
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ auth/                     # Authentication-related components
â”‚       â””â”€â”€ RequireAuth.tsx          # Route guard / auth wrapper
â”‚
â”œâ”€â”€ ğŸ“‚ pages/                        # Page-level components (one per route)
â”‚   â”œâ”€â”€ Home.tsx                     # Marketing homepage (public)
â”‚   â”œâ”€â”€ Login.tsx                    # Login page (public)
â”‚   â”œâ”€â”€ Signup.tsx                   # Signup page (public)
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“‚ dashboard/                # Protected dashboard pages
â”‚       â”œâ”€â”€ DashboardHome.tsx        # Dashboard main view (KPIs, charts)
â”‚       â”œâ”€â”€ Leads.tsx                # Leads page wrapper
â”‚       â”œâ”€â”€ Conversations.tsx        # Conversations / Shared Inbox page
â”‚       â”œâ”€â”€ Deals.tsx                # Sales Pipeline (Kanban) page
â”‚       â”œâ”€â”€ Revenue.tsx              # Analytics & Revenue Dashboard
â”‚       â”œâ”€â”€ Reports.tsx              # Reports page
â”‚       â””â”€â”€ Settings.tsx             # User Settings & Integrations
â”‚
â”œâ”€â”€ ğŸ“‚ context/                      # React Context API (state management)
â”‚   â””â”€â”€ AuthContext.tsx              # User authentication & company context
â”‚
â”œâ”€â”€ ğŸ“‚ data/                         # Mock data & constants
â”‚   â””â”€â”€ mockData.ts                  # Mock companies, leads, messages, deals, agents
â”‚
â”œâ”€â”€ ğŸ“‚ types/                        # TypeScript interfaces & types
â”‚   â””â”€â”€ index.ts                     # Centralized type definitions
â”‚
â”œâ”€â”€ ğŸ“‚ utils/                        # Utility functions
â”‚   â””â”€â”€ formatINR.ts                 # Indian Rupee (â‚¹) currency formatting
â”‚
â”œâ”€â”€ App.tsx                          # Main router configuration
â”œâ”€â”€ main.tsx                         # React entry point (renders App)
â”œâ”€â”€ index.css                        # Tailwind CSS imports + global styles
â””â”€â”€ vite-env.d.ts                    # Vite type definitions
```

### Frontend Technology Stack

| Layer | Technology | Purpose | Version |
|-------|-----------|---------|---------|
| **Framework** | React | UI library | ^18.3.1 |
| **Language** | TypeScript | Type safety | ~5.6.2 |
| **Styling** | Tailwind CSS | Utility-first CSS | ^3.4.15 |
| **Build Tool** | Vite | Fast dev server & bundler | ^5.4.10 |
| **Routing** | React Router | Client-side navigation | ^6.28.0 |
| **Icons** | Lucide React | Icon library | ^0.454.0 |
| **Notifications** | react-hot-toast | Toast notifications | ^2.4.0 |
| **Charts** | Recharts | Data visualization | ^2.6.2 |
| **Animations** | Framer Motion | Motion/animation library | ^10.12.16 |
| **UI Components** | @headlessui/react | Unstyled accessible components | ^1.7.17 |

### Running Frontend

```bash
# Install dependencies
npm install

# Start development server (port 5173)
npm run dev

# Build for production
npm run build

# Preview production build locally
npm run preview
```

---

## ğŸ”Œ BACKEND (`leadsync-backend/`)

### Directory Structure

```
leadsync-backend/
â”œâ”€â”€ ğŸ“‚ src/                          # Source code
â”‚   â”œâ”€â”€ ğŸ“‚ routes/                   # API endpoints organization
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ leads/                # Lead management endpoints
â”‚   â”‚   â”‚   â””â”€â”€ leads.routes.ts      # GET/POST/PUT/DELETE for leads
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ telegram/             # Telegram integration endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ telegram.controller.ts # Handler logic
â”‚   â”‚   â”‚   â””â”€â”€ telegram.routes.ts   # Telegram webhook routes
â”‚   â”‚   â”œâ”€â”€ auth.routes.ts           # Authentication (login, signup)
â”‚   â”‚   â”œâ”€â”€ conversations.routes.ts  # Conversation/messaging endpoints
â”‚   â”‚   â”œâ”€â”€ integrations.routes.ts   # Third-party integrations
â”‚   â”‚   â”œâ”€â”€ public.routes.ts         # Public endpoints (no auth required)
â”‚   â”‚   â””â”€â”€ secure.routes.ts         # Protected endpoints (auth required)
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ services/                 # Business logic & external integrations
â”‚   â”‚   â”œâ”€â”€ telegram.service.ts      # Telegram API interactions
â”‚   â”‚   â””â”€â”€ telegram.webhook.ts      # Webhook handling
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ bot/                      # Bot-related logic
â”‚   â”‚   â”œâ”€â”€ bot.logic.ts             # Bot conversation logic
â”‚   â”‚   â””â”€â”€ telegram.sender.ts       # Send messages to Telegram
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ middleware/               # Express middleware
â”‚   â”‚   â””â”€â”€ auth.middleware.ts       # JWT authentication verification
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ lib/                      # Utility libraries
â”‚   â”‚   â”œâ”€â”€ api.ts                   # API client utilities
â”‚   â”‚   â””â”€â”€ prisma.ts                # Prisma client instance
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ utils/                    # Helper functions
â”‚   â”‚   â””â”€â”€ jwt.ts                   # JWT token generation & verification
â”‚   â”‚
â”‚   â”œâ”€â”€ app.ts                       # Express app setup (middleware, routes)
â”‚   â””â”€â”€ server.ts                    # Server entry point (listen on port 4000)
â”‚
â”œâ”€â”€ ğŸ“‚ prisma/                       # Database schema & migrations
â”‚   â”œâ”€â”€ schema.prisma                # Data model definition
â”‚   â”œâ”€â”€ seed.ts                      # Database seeding script
â”‚   â””â”€â”€ ğŸ“‚ migrations/               # Database migration history
â”‚       â”œâ”€â”€ migration_lock.toml      # Migration lock file
â”‚       â”œâ”€â”€ 20260208094647_init/
â”‚       â”œâ”€â”€ 20260208182720_add_telegram_webhook_secret_and_fix_relations/
â”‚       â”œâ”€â”€ 20260208183718_add_telegram_webhook_secret/
â”‚       â”œâ”€â”€ 20260208202707_add_conversation_mode/
â”‚       â”œâ”€â”€ 20260208211639_fix_company_conversation_relation/
â”‚       â””â”€â”€ 20260208212439_finalize_conversation_schema/
â”‚
â”œâ”€â”€ ğŸ“„ package.json                  # Backend dependencies
â”œâ”€â”€ ğŸ“„ tsconfig.json                 # TypeScript config
â”œâ”€â”€ ğŸ“„ tsconfig.prisma.json          # TypeScript config for Prisma
â””â”€â”€ ğŸ“„ .env                          # Environment variables (local)
```

### Backend Technology Stack

| Component | Technology | Purpose | Version |
|-----------|-----------|---------|---------|
| **Runtime** | Node.js | JavaScript runtime | Latest |
| **Framework** | Express | Web server framework | ^4.22.1 |
| **Language** | TypeScript | Type-safe backend | ^5.9.3 |
| **Database** | PostgreSQL | Relational database | (via Prisma) |
| **ORM** | Prisma | Database client & migrations | ^6.6.0 |
| **Authentication** | JWT | Token-based auth | jsonwebtoken ^9.0.3 |
| **Hashing** | bcryptjs | Password hashing | ^3.0.3 |
| **CORS** | cors | Cross-origin requests | ^2.8.6 |
| **Env Config** | dotenv | Environment variables | ^17.2.4 |
| **HTTP Client** | axios | API requests | ^1.13.5 |
| **Dev Server** | ts-node-dev | Hot-reload TypeScript | ^2.0.0 |

### Running Backend

```bash
# Navigate to backend directory
cd leadsync-backend

# Install dependencies
npm install

# Set up database (create/migrate)
npx prisma migrate deploy

# Seed database (optional)
npm run seed

# Start development server (port 4000)
npm run dev

# With ngrok tunnel (for Telegram webhooks)
npm run dev:all
```

---

## ğŸ“Š Database Schema (Prisma)

### Data Models

#### 1. **Company** (Multi-tenant root)
```
Company
â”œâ”€â”€ id (UUID) [PRIMARY KEY]
â”œâ”€â”€ name (String)
â”œâ”€â”€ telegramBotToken (String, optional)
â”œâ”€â”€ telegramBotUsername (String, optional)
â”œâ”€â”€ telegramWebhookSecret (String, unique, optional)
â”œâ”€â”€ createdAt (DateTime)
â”œâ”€â”€ 
â””â”€â”€ Relations:
    â”œâ”€â”€ users (One-to-Many â†’ User)
    â”œâ”€â”€ leads (One-to-Many â†’ Lead)
    â””â”€â”€ conversations (One-to-Many â†’ Conversation)
```

#### 2. **User** (Team agent or owner)
```
User
â”œâ”€â”€ id (UUID) [PRIMARY KEY]
â”œâ”€â”€ email (String)
â”œâ”€â”€ name (String)
â”œâ”€â”€ passwordHash (String)
â”œâ”€â”€ role (Enum: OWNER | AGENT)
â”œâ”€â”€ companyId (String, FOREIGN KEY)
â”œâ”€â”€ createdAt (DateTime)
â”‚
â”œâ”€â”€ Unique Index: (email, companyId)
â”‚
â””â”€â”€ Relations:
    â””â”€â”€ company (Many-to-One â† Company)
```

#### 3. **Lead** (Contact record)
```
Lead
â”œâ”€â”€ id (UUID) [PRIMARY KEY]
â”œâ”€â”€ name (String, optional)
â”œâ”€â”€ contact (String) â€” phone/email
â”œâ”€â”€ channel (Enum: WEBSITE | TELEGRAM | WHATSAPP)
â”œâ”€â”€ companyId (String, FOREIGN KEY)
â”œâ”€â”€ createdAt (DateTime)
â”‚
â”œâ”€â”€ Unique Index: (contact, channel, companyId)
â”‚
â””â”€â”€ Relations:
    â”œâ”€â”€ company (Many-to-One â† Company)
    â””â”€â”€ conversations (One-to-Many â†’ Conversation)
```

#### 4. **Conversation** (Thread with a lead)
```
Conversation
â”œâ”€â”€ id (UUID) [PRIMARY KEY]
â”œâ”€â”€ leadId (String, FOREIGN KEY)
â”œâ”€â”€ companyId (String, FOREIGN KEY)
â”œâ”€â”€ channel (Enum: WEBSITE | TELEGRAM | WHATSAPP)
â”œâ”€â”€ mode (Enum: BOT | HUMAN)
â”œâ”€â”€ createdAt (DateTime)
â”œâ”€â”€ updatedAt (DateTime)
â”‚
â”œâ”€â”€ Indexes: (companyId), (leadId)
â”‚
â””â”€â”€ Relations:
    â”œâ”€â”€ lead (Many-to-One â† Lead)
    â”œâ”€â”€ company (Many-to-One â† Company)
    â””â”€â”€ messages (One-to-Many â†’ Message)
```

#### 5. **Message** (Individual message in conversation)
```
Message
â”œâ”€â”€ id (UUID) [PRIMARY KEY]
â”œâ”€â”€ content (String)
â”œâ”€â”€ sender (Enum: CLIENT | AGENT | SYSTEM)
â”œâ”€â”€ conversationId (String, FOREIGN KEY)
â”œâ”€â”€ createdAt (DateTime)
â”‚
â””â”€â”€ Relations:
    â””â”€â”€ conversation (Many-to-One â† Conversation)
```

### Enums Defined

```typescript
enum ConversationMode {
  BOT      // Automated bot responses
  HUMAN    // Agent-handled conversation
}

enum Channel {
  WEBSITE  // Web form submissions
  TELEGRAM // Telegram messaging
  WHATSAPP // WhatsApp Business API
}

enum Role {
  OWNER    // Company admin
  AGENT    // Team member
}

enum MessageSender {
  CLIENT   // Customer message
  AGENT    // Agent/employee message
  SYSTEM   // Automated system message
}
```

---

## ğŸ” Authentication & Multi-Tenancy

### Authentication Flow

```
1. User clicks "Login" or "Signup"
   â†“
2. Frontend sends credentials to `/api/auth/login` or `/api/auth/signup`
   â†“
3. Backend validates credentials and company association
   â†“
4. Backend generates JWT token (includes userId, companyId)
   â†“
5. Frontend stores JWT in localStorage
   â†“
6. All subsequent requests include JWT in Authorization header
   â†“
7. Backend middleware (auth.middleware.ts) verifies JWT on protected routes
   â†“
8. Response includes user data + company context
```

### Multi-Tenancy Pattern

**All data is scoped by `companyId`:**

```typescript
// Example: Get leads for current company
const leads = await prisma.lead.findMany({
  where: {
    companyId: currentUser.companyId  // â† Always filter by company
  }
});

// Example: Create new conversation
const conversation = await prisma.conversation.create({
  data: {
    leadId: leadId,
    companyId: currentUser.companyId, // â† Always include company
    channel: 'TELEGRAM',
    mode: 'BOT'
  }
});
```

### Example JWT Token Payload
```json
{
  "userId": "user-uuid-123",
  "companyId": "company-uuid-456",
  "email": "agent@company.com",
  "role": "AGENT",
  "iat": 1707459600,
  "exp": 1707546000
}
```

---

## ğŸ¯ Core Features Breakdown

### 1. Lead Management

**Frontend Component**: `src/components/leads/LeadsTable.tsx` + `LeadDetailModal.tsx`

**Features**:
- ğŸ“‹ Display all leads in paginated table (6 per page)
- ğŸ” Search by name or email
- ğŸ·ï¸ Filter by source (Website, Chat, Demo, Referral, Social, Other)
- âš¡ Filter by priority (Low, Medium, High, Critical)
- â†•ï¸ Sort by date created, name, or priority
- ğŸ‘ï¸ View lead details in modal with 3 tabs:
  - **Details Tab**: Lead info, assigned agent, company
  - **Notes Tab**: Editable notes, auto-save
  - **Conversations Tab**: Message history with timestamps
- â• Add new notes to leads
- ğŸ—‘ï¸ Delete leads (with confirmation)

**Backend Endpoints** (`leadsync-backend/src/routes/leads/leads.routes.ts`):
- `GET /api/leads` â€” Fetch leads for company
- `POST /api/leads` â€” Create new lead
- `GET /api/leads/:id` â€” Get lead details
- `PUT /api/leads/:id` â€” Update lead
- `DELETE /api/leads/:id` â€” Delete lead

**Database Connection**:
```
Frontend (LeadsTable) 
  â†“
API Call to /api/leads?companyId=...
  â†“
Backend (leads.routes.ts)
  â†“
Prisma ORM
  â†“
PostgreSQL (leads table)
```

---

### 2. Shared Inbox / Conversations

**Frontend Component**: `src/components/conversations/ChatPanel.tsx` + `src/pages/dashboard/Conversations.tsx`

**Features**:
- ğŸ’¬ View all conversations per company
- ğŸ“ Message threads with auto-scroll
- ğŸ‘¤ Sender badges (Lead, Agent, Auto-response)
- ğŸ• Timestamp for each message
- ğŸ“ Attachment button (placeholder)
- ğŸ”„ Toggle auto-response mode
- ğŸ”” Unread message indicators

**Backend Endpoints** (`leadsync-backend/src/routes/conversations.routes.ts`):
- `GET /api/conversations` â€” Fetch all conversations
- `POST /api/conversations` â€” Create conversation
- `GET /api/conversations/:id/messages` â€” Get messages in conversation
- `POST /api/conversations/:id/messages` â€” Send new message

---

### 3. Sales Pipeline (Deals)

**Frontend Component**: `src/pages/dashboard/Deals.tsx`

**Features**:
- ğŸ—ï¸ Kanban board with 5 stages:
  - Qualified
  - Proposal
  - Negotiation
  - Closed Won
  - Closed Lost
- ğŸ“Š Metrics cards:
  - Closed Revenue Value (â‚¹) + % trend
  - Active Deals Count
  - Average Deal Size
- ğŸ‘¤ Agent filter dropdown
- ğŸ¨ Color-coded stage backgrounds
- ğŸ“ˆ Drag-drop placeholder (ready for implementation)

**Data Structure** (from `mockData.ts`):
```typescript
interface Deal {
  id: string;
  name: string;
  leadId: string;
  agentId: string;
  agentName: string;
  stage: 'qualified' | 'proposal' | 'negotiation' | 'closed-won' | 'closed-lost';
  value: number; // in INR
  companyId: string;
  createdAt: string;
}
```

---

### 4. Revenue Analytics

**Frontend Component**: `src/pages/dashboard/Revenue.tsx`

**Features**:
- ğŸ“… Period toggle (Day, Month, Year)
- ğŸ“ˆ Trend indicator (% vs previous period)
- 3 KPI Cards:
  - Total Revenue (â‚¹)
  - Closed Deals Count
  - Companies Count
- ğŸ“Š Company-wise Revenue Table (with progress bars)
- ğŸ‘¥ Agent-wise Performance Table (revenue, deal count, avg deal size)
- ğŸ“‰ Time-series chart placeholder (ready for Recharts BarChart/AreaChart)

**Example Data Flow**:
```
Period: "Month" â†’ Fetch deals from last 30 days
â†’ Sum revenue where stage = 'closed-won'
â†’ Calculate % difference from previous month
â†’ Display trend (â†‘ green or â†“ red)
```

---

### 5. Settings & Integrations

**Frontend Component**: `src/pages/dashboard/Settings.tsx`

**Features**:
- ğŸ‘¤ **Profile Tab**:
  - View/edit name and email
  - Read-only company and role
  
- ğŸ”” **Notifications Tab**:
  - Toggle email on lead assignment
  - Toggle daily lead digest
  - Toggle auto-response notifications

- ğŸ¨ **Appearance Tab**:
  - Dark/Light mode toggle (UI ready, no-op for now)

- ğŸ”Œ **Integrations Tab**: 4 integration cards
  - Slack OAuth (placeholder)
  - WhatsApp Business (placeholder)
  - Email IMAP/SMTP (placeholder)
  - Lead Sources API (placeholder)

- âš ï¸ **Danger Zone**:
  - Delete account (with confirmation modal)

---

### 6. Telegram Integration

**Backend Components**:
- `src/services/telegram.service.ts` â€” Telegram API client
- `src/services/telegram.webhook.ts` â€” Webhook handling
- `src/bot/bot.logic.ts` â€” Conversation logic
- `src/bot/telegram.sender.ts` â€” Send messages to Telegram
- `src/routes/telegram/telegram.routes.ts` â€” Webhook endpoints

**Features**:
- ğŸ¤– Receive Telegram messages as leads
- ğŸ’¬ Create conversations automatically
- ğŸ”„ Switch between BOT mode (automated) and HUMAN mode (agent-handled)
- ğŸ“¨ Send responses back to Telegram

**Example Webhook Flow**:
```
Telegram User sends message to Bot
  â†“
Telegram API â†’ POST /api/telegram/webhook (with X-Telegram-Bot-API-Secret-Token)
  â†“
Backend verifies webhook secret
  â†“
Extract message, sender, contact info
  â†“
Create or fetch Lead (based on contact)
  â†“
Create or fetch Conversation
  â†“
Create Message record in DB
  â†“
Run bot.logic.ts to generate auto-response (if BOT mode)
  â†“
Send response back via telegram.sender.ts
```

---

## ğŸŒ API Routes Structure

### Public Routes (No Auth Required)

```
GET  /health                           Health check
GET  /api/public/...                   Public endpoints
GET  /                                 Home page (frontend)
GET  /login                            Login page (frontend)
GET  /signup                           Signup page (frontend)
```

### Auth Routes

```
POST /api/auth/signup                  Register new user + company
POST /api/auth/login                   Login user
POST /api/auth/logout                  Logout user (frontend clears token)
```

### Protected Routes (Require JWT)

```
GET  /api/leads                        List company leads
POST /api/leads                        Create lead
GET  /api/leads/:id                    Get lead details
PUT  /api/leads/:id                    Update lead
DELETE /api/leads/:id                  Delete lead

GET  /api/conversations                List conversations
POST /api/conversations                Create conversation
GET  /api/conversations/:id/messages   Get conversation messages
POST /api/conversations/:id/messages   Send message

GET  /api/integrations                 List integrations
POST /api/integrations/:type/connect   Connect integration
```

### Telegram Routes

```
POST /api/telegram/webhook             Receive Telegram messages
POST /api/telegram/send                Send Telegram message
```

---

## ğŸš€ Key Development Workflows

### Workflow 1: Adding a New lead

```
Frontend (LeadDetailModal.tsx)
  â†“ User fills form + clicks "Create Lead"
  â†“ POST /api/leads { name, email, phone, source, priority, companyId }
  â†“
Backend (leads.routes.ts â†’ leads.service.ts)
  â†“ Validate input
  â†“ prisma.lead.create({ ... companyId })
  â†“ Return new lead object
  â†“
Frontend receives response
  â†“ Update local state or refetch leads table
  â†“ Show success toast
```

### Workflow 2: Receiving Telegram Message

```
Telegram User
  â†“ Sends message to bot
  â†“
Telegram API
  â†“ POST /api/telegram/webhook { message, from, chat_id }
  â†“
Backend (telegram.webhook.ts)
  â†“ Verify webhook secret
  â†“ Extract contact (phone or email from Telegram user)
  â†“ prisma.lead.upsert({ contact, channel: 'TELEGRAM' })
  â†“
Backend (bot.logic.ts)
  â†“ Generate auto-response (e.g., "Thanks for contacting us!")
  â†“
Backend (telegram.sender.ts)
  â†“ Send response via Telegram API
  â†“
prisma.message.create({ content: "...", sender: 'BOT', conversationId })
```

### Workflow 3: Agent Replies to Telegram Lead

```
Dashboard (ChatPanel.tsx)
  â†“ Agent types message + clicks "Send"
  â†“ POST /api/conversations/:id/messages { content, sender: 'AGENT' }
  â†“
Backend (conversations.routes.ts)
  â†“ Save message to DB
  â†“ Find associated Telegram chat_id
  â†“ Call telegram.sender.send()
  â†“
Telegram User receives message
```

---

## ğŸ’¾ Mock Data Structure

**File**: `src/data/mockData.ts`

The frontend includes comprehensive mock data for development:

```typescript
// 3 sample companies
export const mockCompanies = [
  { id: 'co1', name: 'Company A' },
  { id: 'co2', name: 'Bakery XYZ' },
  { id: 'co3', name: 'Retail Shop 123' }
];

// 50+ mock leads (filtered by companyId)
export const mockLeads = [
  {
    id: 'lead1',
    name: 'John Doe',
    email: 'john@example.com',
    phone: '+91-9876543210',
    source: 'website',
    priority: 'high',
    companyId: 'co1',
    createdAt: '2026-02-01'
  },
  // ... more leads
];

// 30+ mock messages (per conversation)
export const mockMessages = [
  {
    id: 'msg1',
    leadId: 'lead1',
    companyId: 'co1',
    sender: 'CLIENT',
    content: 'Hi, I am interested in your product',
    createdAt: '2026-02-05T10:00:00Z'
  },
  // ... more messages
];

// 20+ mock deals (sales pipeline)
export const mockDeals = [
  {
    id: 'deal1',
    name: 'Enterprise Package',
    leadId: 'lead5',
    agentId: 'agent1',
    agentName: 'Alice',
    stage: 'proposal',
    value: 150000,
    companyId: 'co1',
    createdAt: '2026-01-20'
  },
  // ... more deals
];
```

---

## ğŸ“¦ Environment Configuration

### Frontend (`.env` in frontend root)

```bash
# Optional: Add backend API endpoint
VITE_API_URL=http://localhost:4000
```

### Backend (`leadsync-backend/.env`)

```bash
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/leadsync"

# Server
PORT=4000
NODE_ENV=development

# JWT
JWT_SECRET="your-secret-key-here"

# Telegram
TELEGRAM_BOT_TOKEN="your-telegram-bot-token"
TELEGRAM_WEBHOOK_SECRET="your-webhook-secret"

# CORS
CORS_ORIGIN="http://localhost:5173"
```

---

## âœ… Current Implementation Status

### âœ… Completed
- [x] Frontend React 18 with TypeScript
- [x] Tailwind CSS styling (complete UI polish)
- [x] Multi-tenant architecture throughout
- [x] Lead Management (CRUD, search, filter, pagination)
- [x] Conversations / Shared Inbox UI
- [x] Sales Pipeline (Kanban view)
- [x] Revenue Analytics (period toggle, trends)
- [x] Settings & Integrations pages
- [x] Public marketing homepage
- [x] Auth Context (local state management)
- [x] Toast notification system
- [x] Backend Express server (basic setup)
- [x] Prisma ORM with PostgreSQL schema
- [x] Authentication routes (signup, login)
- [x] Telegram webhook integration (in progress)
- [x] Database migrations (7 completed)

### â³ In Progress
- [ ] Telegram bot logic refinement
- [ ] Real API integration between frontend and backend
- [ ] WhatsApp Business API integration
- [ ] Email IMAP/SMTP integration
- [ ] Agent assignment notifications
- [ ] Deal drag-drop functionality
- [ ] Charts with real data (Recharts integration)

### ğŸ“‹ TODO / Future Enhancements
- [ ] Testing suite (Jest, React Testing Library)
- [ ] WebSockets for real-time conversations
- [ ] Advanced reporting (CSV export, custom queries)
- [ ] Automation rules (auto-assign, auto-reply)
- [ ] AI-powered lead scoring
- [ ] Mobile app (React Native)
- [ ] Deployment (Docker, AWS/Azure)
- [ ] Payment processing (Stripe integration)
- [ ] Advanced user roles & permissions

---

## ğŸ”— Relationship Diagram

```
Company (Tenant Root)
  â”œâ”€ User (Team members)
  |  â””â”€ role: OWNER | AGENT
  |
  â”œâ”€ Lead (Contacts)
  |  â””â”€ channel: WEBSITE | TELEGRAM | WHATSAPP
  |
  â””â”€ Conversation (Threads)
     â”œâ”€ Lead (One-to-Many)
     â”œâ”€ mode: BOT | HUMAN
     â””â”€ Message[] (Messages in thread)
        â””â”€ sender: CLIENT | AGENT | SYSTEM
```

---

## ğŸ“ File Naming Conventions

### Frontend

```
ğŸ“„ Components:
  - PascalCase with .tsx extension
  - Exported as default or named
  - Example: LeadsTable.tsx, ChatPanel.tsx

ğŸ“„ Pages:
  - PascalCase with .tsx extension
  - Placed in src/pages/ directory
  - Example: DashboardHome.tsx

ğŸ“„ Context:
  - PascalCase with "Context" suffix
  - Example: AuthContext.tsx

ğŸ“„ Utilities:
  - camelCase with .ts extension
  - Example: formatINR.ts

ğŸ“„ Types:
  - index.ts in types/ folder
  - Interfaces exported individually
```

### Backend

```
ğŸ“„ Routes:
  - Feature name + .routes.ts
  - Example: leads.routes.ts, auth.routes.ts

ğŸ“„ Services:
  - Feature name + .service.ts (business logic)
  - Example: telegram.service.ts

ğŸ“„ Controllers:
  - Feature name + .controller.ts (optional, for route handlers)
  - Example: telegram.controller.ts

ğŸ“„ Middleware:
  - Feature name + .middleware.ts
  - Example: auth.middleware.ts

ğŸ“„ Utilities:
  - Feature name + .ts
  - Example: jwt.ts
```

---

## ğŸ“ How to Understand This Codebase

**For Frontend Developers**:
1. Start with `src/App.tsx` to understand routing
2. Read `src/context/AuthContext.tsx` for state management
3. Explore `src/components/` for reusable UI components
4. Study `src/pages/` for complete page implementations
5. Check `src/data/mockData.ts` for mock data structure

**For Backend Developers**:
1. Read `leadsync-backend/src/server.ts` and `app.ts` for setup
2. Study `leadsync-backend/prisma/schema.prisma` for database models
3. Explore `leadsync-backend/src/routes/` for API endpoints
4. Analyze `leadsync-backend/src/middleware/auth.middleware.ts` for auth logic
5. Check `leadsync-backend/src/services/` for third-party integrations

**For Full-Stack Understanding**:
1. Follow a user action (e.g., "Create Lead") from frontend to backend
2. Trace the database query via Prisma
3. Understand the multi-tenant filtering at each step
4. Review environment configuration and secrets handling

---

## ğŸš¨ Critical Concepts to Remember

### 1. **Multi-Tenancy is Enforced**
Every query, create, or update MUST include `companyId`. Always filter results by the authenticated user's `companyId`.

### 2. **JWT Authentication**
All protected routes require an `Authorization: Bearer <JWT>` header. The JWT payload includes the user's `companyId`.

### 3. **Mock Data vs Backend**
The frontend currently uses mock data. To integrate with the backend, replace mock data calls with API calls:
```typescript
// Before (mock)
const leads = mockLeads.filter(l => l.companyId === companyId);

// After (API)
const leads = await fetch(`/api/leads?companyId=${companyId}`);
```

### 4. **Frontend is Backend-Agnostic**
The frontend can work with any backend API as long as the response format matches the TypeScript interfaces in `src/types/index.ts`.

### 5. **Database Migrations**
When schema changes, run:
```bash
npx prisma migrate dev --name <migration_name>
```

---

## ğŸ“ Contact & Support

**Project Repository**: LeadSync CRM  
**Frontend Port**: 5173 (Vite dev server)  
**Backend Port**: 4000 (Express server)  
**Database**: PostgreSQL (via Prisma)

---

**This document was generated on February 9, 2026, to provide a complete understanding of the LeadSync CRM project structure for all team members.**
